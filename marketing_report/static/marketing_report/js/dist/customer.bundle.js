(()=>{"use strict";function e(e){return fetch(e).then((e=>e.json()))}const t=document.querySelector(".report-button"),o=document.querySelector(".btn-export"),c=document.querySelector(".current-date"),n=document.querySelector(".years"),r=document.querySelector(".cust__content"),l=document.querySelector(".dict-block__form-input"),a=document.querySelector(".modal-close");async function d(t,o,r){let l=t.dataset.last;l||(l=0);const a=document.querySelector(".cust__content");let d;delete t.dataset.last;const u=a.querySelector(".dict-block__row_hidden"),i=`/marketing/customers_current/${c.value}/${n.value}/${o}/${r}`,m=await e(i);let _=0;const y=[];for(const e of m)_++,d=u.cloneNode(!0),s(e,d),d.classList.remove("dict-block__row_hidden"),50===_&&(d.dataset.last=Number.parseInt(l)+50),a.appendChild(d),y.push(d);return y}function s(t,o){const c=o.querySelectorAll('div[data-field]:not([data-field = ""])');o.dataset.id=t.id;for(const e of c){const o=e.dataset.field;e.textContent=t[o]}o.addEventListener("click",(()=>async function(t,o){let c,n;const r=document.querySelector("#cust-list"),l=r.querySelector(".cust__list");r.querySelector(".import-file-modal__header").textContent=o,(await e(`/marketing/show_customers_of_group/${t}`)).forEach((e=>{c=document.createElement("div"),c.classList.add("import-file-modal__content"),n=document.createElement("div"),n.textContent=e.name,c.appendChild(n),n=document.createElement("div"),n.textContent=e.date_last,c.appendChild(n),l.appendChild(c)})),r.style.display="block",setTimeout((()=>{r.classList.add("import-file-modal_open","wide")}),0)}(t.id,t.name)))}t.addEventListener("click",(async e=>{e.preventDefault();const t=document.querySelector("#customer-0");r.querySelectorAll(".cust__row").forEach((e=>{e.classList.contains("dict-block__row_hidden")||e.remove()})),await d(t,"default",0)})),r.addEventListener("mouseover",(async e=>{const t=r.querySelector('div[data-last]:not([data-last = ""])');if(t){const o=t.dataset.last;if(e.target===t){let e=function(){let e="";return l&&(e=l.value.replace(" ","_")),""===e&&(e="default"),e}();e||(e=""),await d(t,e,o)}}})),o.addEventListener("click",(()=>function(){const e=document.querySelector("#export-form");e.querySelector("#years").value=n.value,e.querySelector("#date").value=c.value,e.submit()}())),a.addEventListener("click",(()=>function(){const e=document.querySelector("#cust-list");setTimeout((()=>{e.classList.remove("import-file-modal_open","wide")}),0),e.querySelector(".cust__list").innerHTML="",e.style.display="none"}()))})();