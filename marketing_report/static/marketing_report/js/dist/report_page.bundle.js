(()=>{"use strict";const e={colorScheme:"ColorScheme",color:"Color",printType:"PrintType",matrixType:"MatrixType",crmType:"CrmType",customerType:"CustomerType",customerGroup:"CustomerGroup",customer:"Customer",businessUnit:"BusinessUnit",typeGroup:"TypeGroup",fedRegion:"FedRegion",regionToFedRegion:"RegionToFedRegion",customerArea:"CustomerArea",detailName:"DetailName",detailInGoods:"DetailInGoods",goods:"Goods",producer:"Producer",color_scheme:"ColorScheme",print_type:"PrintType",matrix_type:"MatrixType",crm_type:"CrmType",customer_type:"CustomerType",customer_group:"CustomerGroup",business_unit:"BusinessUnit",type_group:"TypeGroup",fed_region:"FedRegion",region_to_fed_region:"RegionToFedRegion",customer_area:"CustomerArea",detail_in_goods:"DetailInGoods",detail_name:"DetailName",detail:"DetailInGoods",production:"ProductionReport"};async function t(r){const o=r.closest(".dropdown"),n=o.closest("form"),c=o.querySelector(".dropdown__hidden").name,l=n?n.querySelector(`[data-filter="${c}"]`):null;if(o.querySelector(".dropdown__input").value=r.textContent.trim().replace(/\s+/g," "),o.querySelector(".dropdown__input").dataset.value=r.textContent.trim().replace(/\s+/g," "),o.querySelector(".dropdown__hidden").value=r.dataset.value,r.parentElement.classList.remove("visible"),l){const o=l.closest(".report_dropdown").querySelector("ul");o.innerHTML="",l.value="";const n=l.name;o.closest(".report_dropdown").querySelector(".dropdown__input").value="",o.closest(".report_dropdown").querySelector(".dropdown__input").dataset.value="";const i=`/marketing/dictionary_json_filter/${e[n]}/${e[c]}/${Number.parseInt(r.dataset.value)}`,s=await function(e){return fetch(e).then((e=>e.json()))}(i);!function(e,r){let o;r.forEach((r=>{o=document.createElement("li"),o.onclick=async function(e){e.stopPropagation(),await t(e.target)},o.dataset.value=Object.keys(r)[0],o.textContent=Object.values(r)[0],e.appendChild(o)}))}(o,JSON.parse(s))}}function r(){return JSON.parse(document.getElementById("json-cst-reports").textContent)}function o(){return JSON.parse(document.getElementById("json-goods-reports").textContent)}function n(e,t){return t.find((function(t){return t.code===e})).description}function c(e,c){let l=function(e){const t=e.closest(".report-block").dataset.id,r=(parseInt(t)+1).toString();return e.closest(".report-block").dataset.id=r,r}(e);const i=function(){const e=document.createElement("div");return e.id="temp-node",e.className="temp-block",e}();e.closest(".report-content").insertBefore(i,e.closest(".report-block")),setTimeout((function(){i.style.width="360px"}),0),setTimeout((function(){i.remove();const s=function(e,t){const r=document.getElementById("report-"+e).cloneNode(!0),o=t;return r.id="report-"+o,r.querySelectorAll('[id$="'+e+'"]').forEach((function(t){t.id=t.id.replace(e,o)})),r.querySelectorAll('[for$="'+e+'"]').forEach((function(t){t.setAttribute("for",t.getAttribute("for").replace(e,o))})),r.classList.add("zero-width"),r}(c,l);s.classList.add("temp-width"),s.querySelector(".btn-save").addEventListener("click",(e=>function(e){const t=e.parentElement.parentElement,c=t.id.split("-").pop(),l=parseInt(c)<1e4?"0":"10000",i=t.querySelector('[id^="report-select"]').value,s="0"===l?"Клиенты. "+n(i,r()):"Товары. "+n(i,o()),a=(t.querySelector('[id^="period-select"]').value,t.querySelectorAll('[type="date"]')),d=a[0].value,u=a[1].value;t.querySelector('[id^="parameter-select"]').value,""!==d&&""!==u&&d<u?(function(e){e.querySelector(".report-header").classList.add("report-long__header")}(t),function(e,t){e.classList.add("report-long");const r=e.querySelector(".border-title");r.textContent=t;const o=e.querySelector(".date-row").cloneNode(!0),n=e.querySelector('[id^="report-select"]').parentElement.cloneNode(!0);n.value=e.querySelector('[id^="report-select"]').value,n.style.display="none";const c=e.querySelector('[id^="period-select"]').parentElement.cloneNode(!0);c.value=e.querySelector('[id^="period-select"]').value,c.classList.add("report-long_period");const l=e.querySelector('[id^="parameter-select"]').parentElement.cloneNode(!0);l.value=e.querySelector('[id^="parameter-select"]').value,l.classList.add("report-long_parameter");const i=document.createElement("label");i.textContent=" детализация ",i.setAttribute("for",c.id);const s=document.createElement("label");s.textContent=" показатель ",s.setAttribute("for",l.id),e.querySelector(".report-block-content").innerHTML="",e.querySelector(".report-header").replaceChildren(r,o,s,l,i,c,n)}(t,s)):""===d?a[0].focus():a[1].focus()}(e.target))),s.querySelector(".btn-close").addEventListener("click",(e=>function(e){const t=e.parentElement.parentElement;t.innerHTML="",t.classList.add("report__remove"),setTimeout((function(){t.remove()}),295)}(e.target))),e.closest(".report-content").insertBefore(s,e.closest(".report-block")),function(e){const r=e.querySelector('[id^="period-select"]').parentElement.querySelector(".dropdown__content");let o;for(const[e,n]of Object.entries(JSON.parse(document.getElementById("periods").textContent)))o=document.createElement("li"),o.dataset.value=e,o.textContent=n,o.addEventListener("click",(e=>t(e.target))),r.appendChild(o)}(s),function(e,n){const c=e.querySelector('[id^="report-select"]').parentElement.querySelector(".dropdown__content");let l;(0===n?r():o()).forEach((function(e){l=document.createElement("li"),l.dataset.value=e.code,l.textContent=e.description,l.addEventListener("click",(e=>async function(e){const r=e.parentElement.parentElement,o=r.querySelector(".dropdown__hidden").value,n=e.dataset.value;await t(e);const c=document.querySelector("#money-reports").value.split(","),l=r.parentElement.querySelector('[id^="parameter-select"]').parentElement.querySelector(".dropdown__content");let i;c.includes(o)&&!c.includes(n)?(i=document.querySelector("#time-arguments"),l.innerHTML=i.innerHTML,l.querySelectorAll("li").forEach((e=>e.addEventListener("click",(e=>t(e.target))))),await t(l.querySelector("li"))):!c.includes(o)&&c.includes(n)&&(i=document.querySelector("#money-arguments"),l.innerHTML=i.innerHTML,l.querySelectorAll("li").forEach((e=>e.addEventListener("click",(e=>t(e.target))))),await t(l.querySelector("li")))}(e.target))),c.appendChild(l)}))}(s,c);const a=s.querySelectorAll(".dropdown__content");a.forEach((e=>{e.previousElementSibling.querySelector(".dropdown__input").addEventListener("click",(t=>{return o=t,void((r=e.closest(".dropdown")).contains(o.target)&&r.querySelector("ul").classList.add("visible"));var r,o}))})),a[a.length-1].querySelectorAll("li").forEach((e=>e.addEventListener("click",(e=>t(e.target)))))}),300)}const l=document.querySelector("#customer-report"),i=document.querySelector("#goods-report"),s=document.querySelector("#money-arguments");document.querySelector("#time-arguments").querySelectorAll("li").forEach((e=>{e.addEventListener("click",(e=>t(e.target)))})),s.querySelectorAll("li").forEach((e=>{e.addEventListener("click",(e=>t(e.target)))})),l.addEventListener("click",(e=>{c(e.target,0)})),i.addEventListener("click",(e=>c(e.target,1e4)))})();