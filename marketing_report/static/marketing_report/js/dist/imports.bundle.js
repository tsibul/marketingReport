(()=>{"use strict";function e(e,t){e.disabled=!0,e.classList.add("form-input__inactive");const n=e.closest(".form-row__import").querySelector(".import-block__description"),o=document.getElementById("import-file-modal");o.querySelector("#file-name").value=t,o.style.display="block",o.querySelector(".import-file-modal__header").textContent=n.textContent,setTimeout((()=>{o.classList.add("import-file-modal_open")}),0)}function t(e){return fetch(e).then((e=>e.json()))}async function n(e,n){e.disabled=!0,e.classList.add("form-input__inactive");const o=await t("/marketing/"+n);e.previousElementSibling.textContent=`импортировано ${o.result}`,e.disabled=!1,e.classList.remove("form-input__inactive")}document.querySelector(".modal.close");const o=document.querySelector("#import-file-modal");document.querySelector("#result").nextElementSibling.addEventListener("click",(t=>e(t.target,"customers"))),document.querySelector("#resultSales").nextElementSibling.addEventListener("click",(t=>e(t.target,"sales"))),document.querySelector("#updated-customers").nextElementSibling.addEventListener("click",(e=>async function(e){e.disabled=!0,e.classList.add("form-input__inactive");const n=await t("/marketing/edit_temporary_base"),o=document.getElementById("new-customers"),i=document.getElementById("updated-customers");o.textContent=`новые ${n.new_customers}`,i.textContent=`измененные ${n.updated_customers}`,e.disabled=!1,e.classList.remove("form-input__inactive")}(e.target))),document.querySelector("#import_new_customers").nextElementSibling.addEventListener("click",(e=>n(e.target,"import_new_customers"))),document.querySelector("#import_changed_customers").nextElementSibling.addEventListener("click",(e=>n(e.target,"import_changed_customers"))),document.querySelector("#period-end").nextElementSibling.addEventListener("click",(e=>function(e){e.preventDefault();const t=this.closest("form"),n=t.querySelectorAll(".alert")[0],o=n.textContent.split(".")[2]+"-"+n.textContent.split(".")[1]+"-"+n.textContent.split(".")[0],i=t.querySelectorAll(".alert")[1],s=i.textContent.split(".")[2]+"-"+i.textContent.split(".")[1]+"-"+i.textContent.split(".")[0],r=new FormData(this);fetch(this.action,{method:"POST",body:r}).then((e=>e.json())).then((e=>{o>e.period_begin&&(n.textContent=e.period_begin),s<e.period_end&&(i.textContent=e.period_end)})).catch((e=>{console.error("Ошибка:",e)}))}(e.target))),document.querySelector("#firstLastDate").nextElementSibling.addEventListener("click",(e=>async function(e){e.disabled=!0,e.classList.add("form-input__inactive"),await fetch("/marketing/first_last_sales_dates"),e.previousElementSibling.textContent="выполнено",e.disabled=!1,e.classList.remove("form-input__inactive")}(e.target))),o.querySelector(".btn-close").addEventListener("click",(e=>function(e){const t=e.closest("#import-file-modal");t.classList.remove("import-file-modal_open"),setTimeout((()=>{t.style.display="none",t.querySelector("#file-name").value="",t.querySelector(".import-file-modal__header").textContent="Что-то пошло не так"}),250)}(e.target))),document.querySelector(".import-file-modal__body").addEventListener("submit",(function(e){e.preventDefault();const t=document.getElementById("import-file-modal");t.classList.remove("import-file-modal_open"),setTimeout((()=>{t.style.display="none"}),300);const n=new FormData(this);fetch(this.action,{method:"POST",body:n}).then((e=>e.json())).then((e=>{const t=document.getElementById("result"),n=new Date;t.textContent=`${n.getHours()}:${n.getMinutes()} — ${e.result} записей импортировано`;const o=document.querySelector(".form-input__inactive");o.disabled=!1,o.classList.remove("form-input__inactive")})).catch((e=>{console.error("Ошибка:",e)}))}))})();